@model IEnumerable<EmmasEngines.Models.Inventory>
@using Microsoft.AspNetCore.Http
@using Newtonsoft.Json;
@using EmmasEngines.Utilities;
@inject IHttpContextAccessor HttpContextAccessor;

@{
	ViewData["Title"] = "Index";
}
<link rel="stylesheet" href="~/css/styles.css" asp-append-version="true" />
<main>
	<section id="pageName">
		<h1>POS</h1>
	</section>
	<script src="/lib/jquery/dist/jquery.min.js"></script>

	<section id="customerSearch">
		@*Set POS Cart to a Customer, by searching 'Last 4 Phone Digits' or 'Customer Name'*@
		<input class="form-control" id="SearchString" name="SearchPhone" type="text" placeholder="Enter Last 4 Phone Digits Eg. ####">
		<input class="form-control" id="SearchString" name="SearchCustName" type="text" placeholder="Search Customer... Eg. John">
		
		@*When pressed, Modal box of Customer Name, Phone, Address, Postal*@
		<div class="btn">
			<button type="submit" name="actionButton" value="customerDetails" tabindex="190" class="" onclick="" aria-label="button for edit items">
				Details
			</button>
			<span class="btn_tooltip">Filter</span>
		</div>
		@*When pressed, Modal box to add customer. Set cart to this customer.*@
		<div class="btn">
			<button type="submit" name="actionButton" value="addCustomer" tabindex="190" class="" onclick="" aria-label="button for edit items">
				Add Customer
			</button>
		</div>
	</section>

	<form asp-action="Index" method="get">
		<div class="form-horizontal">
			@*Search Inventory by name (+ buttons to submit, clear)*@
			<section id="inventorySearch" style="">
				<h2><label id="searchHeader" class="control-label">Search Inventory: </label></h2>
				<input class="form-control" id="SearchString" name="SearchString" type="text" placeholder="Enter UPC Eg. ###-####-# or Inventory Name Eg. Mower">
				<div class="btn">
					<div class="btn_crud">
						<button type="submit" name="actionButton" value="Filter" tabindex="190" class="btn_crud_edit" onclick="" aria-label="button for edit items">
							<i class="fa fa-filter" aria-hidden="true"></i>
						</button>
						<span class="btn_tooltip">Filter</span>
					</div>
					<div class="btn_crud">
						<button type="submit" name="actionButton" value="Filter" tabindex="190" class="btn_crud_edit" asp-action="Index" aria-label="button for edit items">
							<i class="fa fa-eraser" aria-hidden="true"></i>
						</button>
						<span class="btn_tooltip">Clear</span>
					</div>             
				</div>
			</section>
		</div>

		<div id="inventoryMain">
			<div class=" divider2_desc_btn">
				<div class="description">

					<table class="table table-striped" id="inventoryTable">
						<thead>
							<tr class="bg-info">
								<th>
									<input type="submit" name="actionButton" value="UPC" class="tableHeaders" />
								</th>
								<th>
									<input type="submit" name="actionButton" value="Name" class="tableHeaders" />
								</th>
								<th>
									<input type="submit" name="actionButton" value="Size" class="no-click" />
								</th>
								<th>
									<input type="submit" name="actionButton" value="Quantity" class="no-click" />
								</th>
								<th>
									<input type="submit" name="actionButton" value="Cost (AVG)" class="tableHeaders" />
								</th>
								<th>
									<input type="submit" name="actionButton" value="Price (Retail)" class="tableHeaders" />
								</th>
								<th>
									<input type="submit" disabled="disabled" value="Current" class="tableHeaders" />
								</th>
								<th>
									<input type="submit" disabled="disabled" value="Stock" class="tableHeaders" />
								</th>
								<th></th>
							</tr>
						</thead>
						<tbody id="inventoryData">
							@foreach (var item in Model)
							{
								<tr class="table-hover">
									<td>
										@Html.DisplayFor(modelItem => item.UPC)
									</td>
									<td>
										@Html.DisplayFor(modelItem => item.Name)
									</td>
									<td>
										@Html.DisplayFor(modelItem => item.Size)
									</td>
									<td>
										@Html.DisplayFor(modelItem => item.Quantity)
									</td>
									<td>
										@Html.DisplayFor(modelItem => item.AdjustedPrice)
									</td>
									<td>
										@Html.DisplayFor(modelItem => item.MarkupPrice)
									</td>
									<td>
										@Html.DisplayFor(modelItem => item.Current)
									</td>
									<td>
										@Html.DisplayFor(modelItem => item.TotalStock)
									</td>
									<td>
										<a asp-action="Add" asp-route-id="@item.ID">(+) Add to Cart</a>
									</td>
								</tr>
							}
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div class="cart">
			@*Create a new table with headers for "Name", "Price", "Quantity".*@
			@*Table starts empty. Items are added by POSController.AddToCart, returning a single JSON inventory object*@
			@*The table is then populated with the JSON object*@
			@*The table is then updated every time a new item is added to the cart*@
			<table class="table table-striped" id="invoiceTable">
				<thead>
					<tr class="bg-info">
						<th>
							<input type="submit" disabled="disabled" value="Name" class="tableHeaders" />
						</th>
						<th>
							<input type="submit" disabled="disabled" value="Price" class="tableHeaders" />
						</th>
						<th>
							<input type="submit" disabled="disabled" value="Quantity" class="tableHeaders" />
						</th>
						<th></th>
					</tr>
				</thead>
				<tbody id="cartData">
					@*add a new item (name, price, quantity) by a given UPC code*@
					@*the item is added to the cart, and the cart is updated*@
					@*the cart is then displayed in the table*@
					@*Use the "Buy(string UPC) function / HttpContext.Session["cart"] to update the table *@
					
				@{
						var cart = (List<Inventory>)HttpContextAccessor.HttpContext.Session.GetObjectFromJson<List<Inventory>>("cart");
						if(cart != null){		
							foreach (Inventory item in cart)
							{
								<tr class="table-hover">
									<td>
										@Html.DisplayFor(modelItem => item.Name)
									</td>
									<td>
										@Html.DisplayFor(modelItem => item.AdjustedPrice)
									</td>
									<td>
										@Html.DisplayFor(modelItem => item.Quantity)
									</td>
									<td>
										<a asp-action="Remove" asp-route-id="@item.ID">(-) Remove from Cart</a> |
									</td>
								</tr>
							}
						}
						
				}
					
					
				</tbody>
			</table>
		</div>

		<partial name="_PagingNavBar" />
	</form>
</main>
<script src="https://kit.fontawesome.com/f8c88d6b79.js" crossorigin="anonymous"></script>


